# Minimal Kernel Config for Radxa Zero 3
# Target: tezsign functionality with minimal attack surface
# Based on: Armbian 6.12 kernel for bcm2711

# Build instructions:
# 1. Place this in armbian/build/userpatches/
# 2. Run: ./compile.sh BOARD=radxa-zero3 BRANCH=current KERNEL_CONFIGURE=yes
# 3. Use this config as baseline

# === CORE SYSTEM ===
CONFIG_LOCALVERSION="-tezsign-minimal"
CONFIG_DEFAULT_HOSTNAME="tezsign"

# === CPU/ARCHITECTURE ===
CONFIG_ARM64=y
CONFIG_ARCH_BCM2711=y
CONFIG_SMP=y
CONFIG_NR_CPUS=4

# === MEMORY ===
CONFIG_MMU=y
CONFIG_SPARSEMEM=y

# === FILESYSTEMS (KEEP ONLY THESE) ===
CONFIG_EXT4_FS=y
CONFIG_EXT4_USE_FOR_EXT2=y
CONFIG_VFAT_FS=y
CONFIG_FAT_FS=y
CONFIG_MSDOS_FS=y
CONFIG_NLS_CODEPAGE_437=y
CONFIG_NLS_ISO8859_1=y
CONFIG_NLS_UTF8=y

# === USB GADGET (CRITICAL FOR TEZSIGN) ===
CONFIG_USB=y
CONFIG_USB_GADGET=y
CONFIG_USB_DWC2=y
CONFIG_USB_GADGET_VBUS_DRAW=500
CONFIG_USB_GADGET_STORAGE=y
CONFIG_USB_ETH=y
CONFIG_USB_ETH_EEM=y
CONFIG_USB_ETH_RNDIS=y
CONFIG_USB_CDC_COMPOSITE=y
CONFIG_USB_G_ACM_MS=y
CONFIG_USB_G_MULTI=y
CONFIG_USB_G_MULTI_RNDIS=y
CONFIG_USB_G_MULTI_CDC=y
CONFIG_USB_G_HID=y
CONFIG_USB_G_DBGP=y
CONFIG_USB_G_WEBCAM=n
CONFIG_USB_G_PRINTER=n

# === SERIAL CONSOLE ===
CONFIG_SERIAL_8250=y
CONFIG_SERIAL_8250_CONSOLE=y
CONFIG_SERIAL_OF_PLATFORM=y
CONFIG_SERIAL_AMBA_PL011=y
CONFIG_SERIAL_AMBA_PL011_CONSOLE=y
CONFIG_TTY=y

# === CRYPTO (FOR TEZSIGN OPERATIONS) ===
CONFIG_CRYPTO=y
CONFIG_CRYPTO_ALGAPI=y
CONFIG_CRYPTO_AES=y
CONFIG_CRYPTO_SHA256=y
CONFIG_CRYPTO_SHA512=y
CONFIG_CRYPTO_RSA=y
CONFIG_CRYPTO_ECDH=y
CONFIG_CRYPTO_ECC=y
CONFIG_CRYPTO_CURVE25519=y
CONFIG_CRYPTO_DEV_BCM2835=y
CONFIG_ARM64_CRYPTO=y
CONFIG_CRYPTO_SHA1_ARM64_CE=y
CONFIG_CRYPTO_SHA2_ARM64_CE=y
CONFIG_CRYPTO_AES_ARM64=y
CONFIG_CRYPTO_AES_ARM64_CE=y

# === NETWORKING (MINIMAL) ===
CONFIG_NET=y
CONFIG_INET=y
CONFIG_IPV6=n
CONFIG_NETDEVICES=y
CONFIG_USB_USBNET=y
CONFIG_USB_NET_CDCETHER=y
CONFIG_USB_NET_RNDIS_HOST=y

# === BLOCK/STORAGE ===
CONFIG_BLOCK=y
CONFIG_BLK_DEV=y
CONFIG_BLK_DEV_LOOP=y
CONFIG_MMC=y
CONFIG_MMC_BLOCK=y
CONFIG_MMC_SDHCI=y
CONFIG_MMC_SDHCI_PLTFM=y
CONFIG_MMC_BCM2835=y
CONFIG_SCSI=n
CONFIG_ATA=n
CONFIG_NVME=n

# === POWER/THERMAL ===
CONFIG_POWER_SUPPLY=y
CONFIG_REGULATOR=y
CONFIG_THERMAL=y
CONFIG_BCM2835_THERMAL=y
CONFIG_WATCHDOG=y
CONFIG_BCM2835_WDT=y

# === DISABLED (REMOVED FOR MINIMAL SIZE) ===
# Audio
CONFIG_SOUND=n
CONFIG_SND=n
# Video/GPU
CONFIG_DRM=n
CONFIG_FB=n
CONFIG_VGA_ARB=n
CONFIG_AGP=n
# Wireless
CONFIG_CFG80211=n
CONFIG_MAC80211=n
CONFIG_WLAN=n
CONFIG_BT=n
# Various other drivers
CONFIG_MEDIA_SUPPORT=n
CONFIG_MEDIA_CAMERA_SUPPORT=n
CONFIG_MEDIA_USB_SUPPORT=n
CONFIG_USB_VIDEO_CLASS=n
# Filesystems we don't need
CONFIG_BTRFS_FS=n
CONFIG_XFS_FS=n
CONFIG_F2FS_FS=n
CONFIG_NTFS_FS=n
CONFIG_HFS_FS=n
CONFIG_HFSPLUS_FS=n
CONFIG_JFS_FS=n
CONFIG_REISERFS_FS=n
CONFIG_GFS2_FS=n
CONFIG_OCFS2_FS=n
CONFIG_QUOTA=n
# Network protocols not needed
CONFIG_BRIDGE=n
CONFIG_VLAN_8021Q=n
CONFIG_NETFILTER=n
CONFIG_IP_NF_IPTABLES=n
CONFIG_IP6_NF_IPTABLES=n
# Debug/development
CONFIG_DEBUG_KERNEL=n
CONFIG_DEBUG_FS=n
CONFIG_KGDB=n
CONFIG_MAGIC_SYSRQ=n
# Various unused features
CONFIG_EMBEDDED=y
CONFIG_EXPERT=y
CONFIG_PROFILING=n
CONFIG_OPROFILE=n
CONFIG_KPROBES=n
CONFIG_UPROBES=n
CONFIG_PERF_EVENTS=n

# === RESULT ===
# This should produce a kernel of ~8-12MB
# Down from ~15-20MB in default config
# While maintaining all tezsign functionality
